<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>STOPA ‚Äì St√ºtzenauswahl</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box;}

:root{
  --bg1:#1e3c72;--bg2:#2a5298;
  --card:#fff;--text:#1e3c72;--muted:#666;
  --border:#2a5298;--step:#f4f6fb;--inp:#fff;
  --r1:#667eea;--r2:#764ba2;
  --info-bg:#e8f0fe;--info-b:#2a5298;
}
body.dark{
  --bg1:#07111f;--bg2:#122040;
  --card:#181830;--text:#dde4f0;--muted:#8a9ab8;
  --border:#3d72c4;--step:#1e2744;--inp:#252f4a;
  --r1:#3a4f8a;--r2:#4a366e;
  --info-bg:#14213a;--info-b:#3d72c4;
}

body{
  background:linear-gradient(135deg,var(--bg1) 0%,var(--bg2) 100%);
  background-attachment:fixed;min-height:100vh;
  display:flex;justify-content:center;align-items:center;
  padding:16px;font-family:'Segoe UI',sans-serif;position:relative;
}
body::before{
  content:'';position:fixed;inset:0;pointer-events:none;
  background-image:
    repeating-linear-gradient(0deg,transparent,transparent 48px,rgba(255,255,255,.025) 48px,rgba(255,255,255,.025) 49px),
    repeating-linear-gradient(90deg,transparent,transparent 48px,rgba(255,255,255,.025) 48px,rgba(255,255,255,.025) 49px);
}

.wrap{
  background:var(--card);border-radius:14px;padding:20px 24px;
  max-width:1100px;width:100%;
  box-shadow:0 16px 48px rgba(0,0,0,.3);
  position:relative;z-index:1;transition:background .3s;
}

/* ‚îÄ‚îÄ TOPBAR ‚îÄ‚îÄ */
.topbar{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;gap:10px;flex-wrap:wrap;}
.lang-grp{display:flex;gap:8px;}
.lbtn{padding:5px 14px;background:var(--step);border:2px solid var(--border);
  border-radius:5px;cursor:pointer;font-weight:700;color:var(--text);font-size:12px;transition:all .2s;}
.lbtn:hover,.lbtn.on{background:var(--border);color:#fff;}
.theme-row{display:flex;align-items:center;gap:8px;}
.theme-label{font-size:12px;color:var(--muted);}
.sw{width:44px;height:23px;background:var(--border);border-radius:12px;cursor:pointer;position:relative;transition:background .3s;}
.sw::after{content:'';position:absolute;width:17px;height:17px;background:#fff;border-radius:50%;top:3px;left:3px;transition:left .3s;}
body.dark .sw::after{left:24px;}

/* ‚îÄ‚îÄ BRAND ‚îÄ‚îÄ */
.brand{text-align:center;margin-bottom:8px;}
.brand-logo-row{display:flex;align-items:center;justify-content:center;gap:10px;margin-bottom:2px;}
.brand-name{font-size:20px;font-weight:900;letter-spacing:3px;color:var(--border);}
.brand a{display:inline-flex;align-items:center;gap:10px;text-decoration:none;}
h1{font-size:17px;color:var(--text);font-weight:700;margin-bottom:2px;}
.sub{font-size:11px;color:var(--muted);}

/* ‚îÄ‚îÄ LAYOUT ‚îÄ‚îÄ */
.layout{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-top:14px;}

/* ‚îÄ‚îÄ STEPS ‚îÄ‚îÄ */
.steps{display:flex;flex-direction:column;gap:8px;}
.step{
  background:var(--step);border-radius:8px;
  border-left:3px solid var(--border);
  padding:9px 12px;transition:opacity .25s;
}
.step.off{opacity:.38;pointer-events:none;}
.step-head{display:flex;align-items:center;gap:8px;margin-bottom:5px;}
.num{
  background:var(--border);color:#fff;width:22px;height:22px;
  border-radius:50%;display:flex;align-items:center;justify-content:center;
  font-size:11px;font-weight:700;flex-shrink:0;
}
.stitle{font-size:13px;font-weight:700;color:var(--text);}
.ssub{font-size:11px;color:var(--muted);}
select.inp,input.inp{
  width:100%;padding:7px 9px;border:1.5px solid var(--border);
  border-radius:5px;font-size:13px;color:var(--text);
  background:var(--inp);cursor:pointer;
  outline:none;transition:border-color .2s;margin-top:4px;
}
select.inp:focus,input.inp:focus{border-color:var(--r1);}
.inp-row{display:flex;align-items:center;gap:8px;}
.unit{font-size:11px;color:var(--muted);white-space:nowrap;}

/* ‚îÄ‚îÄ RIGHT PANEL ‚îÄ‚îÄ */
.right{display:flex;flex-direction:column;gap:12px;}

/* ‚îÄ‚îÄ DEV NOTICE ‚îÄ‚îÄ */
.dev-notice{
  background:#fff8e1;border-left:4px solid #f59e0b;color:#92400e;
  padding:10px 14px;border-radius:7px;font-size:13px;font-weight:600;
  text-align:center;display:none;
}
body.dark .dev-notice{background:#2d200a;border-color:#f59e0b;color:#fcd34d;}

/* ‚îÄ‚îÄ RESULT BOX ‚îÄ‚îÄ */
.result-box{
  background:linear-gradient(135deg,var(--r1),var(--r2));
  border-radius:10px;padding:16px 18px;color:#fff;
}
.r-section{font-size:9px;font-weight:700;letter-spacing:1.5px;
  text-transform:uppercase;color:rgba(255,255,255,.55);
  border-bottom:1px solid rgba(255,255,255,.2);padding-bottom:4px;margin:8px 0 4px;}
.r-row{display:flex;justify-content:space-between;align-items:baseline;
  padding:4px 0;border-bottom:1px solid rgba(255,255,255,.12);}
.r-row:last-child{border-bottom:none;}
.r-lbl{font-size:12px;color:rgba(255,255,255,.75);}
.r-val{font-size:13px;font-weight:700;color:#fff;}
.r-val.big{font-size:18px;color:#ffe082;}
.r-val.dim{font-size:11px;font-style:italic;color:rgba(255,255,255,.45);}

/* ‚îÄ‚îÄ ACTION BUTTONS ‚îÄ‚îÄ */
.action-btns{display:flex;gap:8px;flex-wrap:wrap;}
.abtn{
  flex:1;min-width:0;padding:9px 10px;border:none;border-radius:7px;
  cursor:pointer;font-size:12px;font-weight:700;transition:all .2s;
  display:flex;align-items:center;justify-content:center;gap:6px;
}
.abtn:hover{transform:translateY(-1px);box-shadow:0 4px 12px rgba(0,0,0,.2);}
.btn-reset{background:#fff;color:var(--r2);}
.btn-pdf  {background:#e53935;color:#fff;}
.btn-tbl  {background:#1565c0;color:#fff;}

/* ‚îÄ‚îÄ INFO BOX ‚îÄ‚îÄ */
.info-box{
  background:var(--info-bg);border-left:4px solid var(--info-b);
  padding:11px 14px;border-radius:7px;font-size:12px;line-height:1.65;
  color:var(--text);
}
.info-box strong{color:var(--info-b);}
.info-box ul{margin:6px 0 0 16px;}
.info-box li{margin:3px 0;}

/* ‚îÄ‚îÄ FULL DATA MODAL ‚îÄ‚îÄ */
.modal-bg{
  display:none;position:fixed;inset:0;background:rgba(0,0,0,.6);
  z-index:999;justify-content:center;align-items:center;padding:20px;
}
.modal-bg.open{display:flex;}
.modal{
  background:var(--card);border-radius:12px;padding:24px;
  max-width:760px;width:100%;max-height:85vh;overflow-y:auto;
  color:var(--text);
}
.modal h2{font-size:16px;margin-bottom:14px;color:var(--border);}
.modal-close{float:right;cursor:pointer;font-size:20px;color:var(--muted);border:none;background:none;}
.tbl{width:100%;border-collapse:collapse;font-size:12px;}
.tbl th{background:var(--border);color:#fff;padding:8px 10px;text-align:left;position:sticky;top:0;z-index:2;}
.tbl td{padding:7px 10px;border-bottom:1px solid var(--step);}
.tbl tr:hover td{background:var(--step);}
.tbl .head-row td{background:var(--info-bg);font-weight:700;font-size:11px;letter-spacing:.5px;color:var(--border);}
.modal-actions{display:flex;gap:10px;margin-bottom:14px;}
.modal-pdf-btn{padding:8px 16px;background:#e53935;color:#fff;border:none;border-radius:6px;cursor:pointer;font-size:12px;font-weight:700;}
.modal-pdf-btn:hover{background:#c62828;}

/* ‚îÄ‚îÄ MOBILE ‚îÄ‚îÄ */
@media(max-width:780px){
  .layout{grid-template-columns:1fr;}
  .wrap{padding:14px 16px;}
  h1{font-size:15px;}
  .action-btns{flex-direction:column;}
  body{align-items:flex-start;padding:12px;}
}
@media(max-width:400px){
  .brand-name{font-size:16px;}
}
</style>
</head>
<body>
<div class="wrap">

  <!-- TOPBAR with brand left, controls right -->
  <div class="topbar" style="align-items:flex-start;">
    <div style="display:flex;flex-direction:column;align-items:flex-start;gap:2px;">
      <a href="https://www.stopa.com/" target="_blank" style="text-decoration:none;">
        <span class="brand-name" style="font-size:32px;">STOPA</span>
      </a>
      <h1 data-en="Column Selection Tool" data-de="St√ºtzenauswahl-Werkzeug" style="font-size:16px;margin:0;">St√ºtzenauswahl-Werkzeug</h1>
      <p class="sub" data-en="HEB steel column selection for automated warehouse systems"
                     data-de="HEB-Stahlst√ºtzenauswahl f√ºr automatische Hochregallager" style="margin:0;">
        HEB-Stahlst√ºtzenauswahl f√ºr automatische Hochregallager</p>
    </div>
    <div class="theme-row">
      <span class="theme-label" data-en="Dark Mode" data-de="Dunkelmodus">Dunkelmodus</span>
      <div class="sw" onclick="document.body.classList.toggle('dark')"></div>
      <select id="lang-sel" onchange="setLang(this.value)" style="margin-left:14px;padding:5px 10px;border:2px solid var(--border);border-radius:5px;background:var(--step);color:var(--text);font-size:12px;font-weight:700;cursor:pointer;">
        <option value="de" selected>üá©üá™ Deutsch</option>
        <option value="en">üá¨üáß English</option>
      </select>
    </div>
  </div>

  <!-- TWO-COLUMN LAYOUT -->
  <div class="layout">

    <!-- ‚ïê‚ïê LEFT: STEPS ‚ïê‚ïê -->
    <div class="steps">

    <!-- PROJECT NAME -->
    <div class="step" id="s0">
      <div class="step-head">
        <div class="num" style="background:var(--muted);">P</div>
        <div>
          <div class="stitle" data-en="Project Name" data-de="Projektname">Projektname</div>
          <div class="ssub" data-en="Optional ‚Äì for display only" data-de="Optional ‚Äì nur zur Anzeige">Optional ‚Äì nur zur Anzeige</div>
        </div>
      </div>
      <input class="inp" type="text" id="proj-name" placeholder="z.B. Projekt M√ºnchen 2026" oninput="calc()">
    </div>

      <!-- STEP 1: LAGER -->
      <div class="step" id="s1">
        <div class="step-head">
          <div class="num">1</div>
          <div>
            <div class="stitle">Lager</div>
            <div class="ssub" data-en="Warehouse system type" data-de="Lagersystemtyp">Warehouse system type</div>
          </div>
        </div>
        <select class="inp" id="lager" onchange="onLager()">
          <option value="TKL Flex">TKL Flex</option>
          <option value="ECO PLUS">ECO PLUS</option>
          <option value="MONO">MONO</option>
          <option value="COMPACT">COMPACT</option>
          <option value="UNIVERSAL">UNIVERSAL</option>
          <option value="LG E">LG E</option>
          <option value="LG T">LG T</option>
          <option value="LG B">LG B</option>
          <option value="LG U">LG U</option>
        </select>
      </div>

      <!-- STEP 2: LAGER TYPE -->
      <div class="step" id="s2">
        <div class="step-head">
          <div class="num">2</div>
          <div>
            <div class="stitle" data-en="Lager Type" data-de="Lagertyp">Lager Type</div>
            <div class="ssub" data-en="Configuration type" data-de="Konfigurationstyp">Configuration type</div>
          </div>
        </div>
        <select class="inp" id="lagertype" onchange="onLagerType()">
          <option value="GF">GF</option>
          <option value="MF">MF</option>
          <option value="XF">XF</option>
          <option value="SF">SF</option>
        </select>
      </div>

      <!-- STEP 3: VARIANTE -->
      <div class="step" id="s3">
        <div class="step-head">
          <div class="num">3</div>
          <div>
            <div class="stitle">Variante</div>
            <div class="ssub" data-en="Rack structure variant" data-de="Regalsystem-Variante">Rack structure variant</div>
          </div>
        </div>
        <select class="inp" id="variante" onchange="calc()">
          <option value="LMS">LMS</option>
          <option value="LMC">LMC</option>
          <option value="DOPPEL">DOPPEL-WAGEN</option>
        </select>
      </div>

      <!-- STEP 4: ERDBEBEN ZONE -->
      <div class="step" id="s4">
        <div class="step-head">
          <div class="num">4</div>
          <div>
            <div class="stitle" data-en="Seismic Zone" data-de="Erdbebenzone">Seismic Zone</div>
            <div class="ssub" data-en="Ground acceleration ag/g" data-de="Bodenbeschleunigung ag/g">Ground acceleration ag/g</div>
          </div>
        </div>
        <select class="inp" id="seismic" onchange="calc()">
          <option value="0.25">0.00 ‚Äì 0.25</option>
          <option value="0.5">0.25 ‚Äì 0.50</option>
          <option value="0.75">0.50 ‚Äì 0.75</option>
          <option value="1.00">0.75 ‚Äì 1.00</option>
          <option value="1.25">1.00 ‚Äì 1.25</option>
          <option value="1.50">1.25 ‚Äì 1.50</option>
        </select>
      </div>

      <!-- STEP 5: H√ñHE -->
      <div class="step" id="s5">
        <div class="step-head">
          <div class="num">5</div>
          <div>
            <div class="stitle" data-en="Height / Effective Length" data-de="H√∂he / Knickl√§nge">Height / Effective Length</div>
            <div class="ssub" data-en="Column height D_A" data-de="St√ºtzenh√∂he D_A">Column height D_A</div>
          </div>
        </div>
        <div class="inp-row">
          <select class="inp" id="hoehe" onchange="onHoehe()" style="flex:1">
            <option value="21">21</option>
            <option value="22">22</option>
            <option value="23">23</option>
            <option value="24" selected>24</option>
            <option value="25">25</option>
            <option value="26">26</option>
            <option value="27">27</option>
            <option value="31">31</option>
            <option value="manual" id="manual-opt">Manual input ‚Ä¶</option>
          </select>
        </div>
        <div id="manual-row" style="display:none;margin-top:6px;" class="inp-row">
          <input class="inp" type="number" id="hoehe-manual" value="24" min="1" step="0.1" oninput="onManual()" style="flex:1">
          <span class="unit" data-en="m" data-de="m">m</span>
        </div>
      </div>

    </div><!-- /steps -->

    <!-- ‚ïê‚ïê RIGHT: RESULTS ‚ïê‚ïê -->
    <div class="right">

      <!-- Dev notice -->
      <div class="dev-notice" id="dev-note">
        <span id="dev-msg"
          data-en="‚ö†Ô∏è This configuration is currently under development."
          data-de="‚ö†Ô∏è Diese Konfiguration befindet sich noch in der Entwicklung.">
          ‚ö†Ô∏è This configuration is currently under development.
        </span>
      </div>

      <!-- Result card -->
      <div class="result-box" id="rbox">
        <div class="r-section" data-en="PROJECT" data-de="PROJEKT">PROJEKT</div>
        <div class="r-row"><span class="r-lbl" data-en="Project Name" data-de="Projektname">Projektname</span><span class="r-val" id="r-projname" style="font-style:italic;color:rgba(255,255,255,.7)">‚Äì</span></div>
        <div class="r-section" data-en="WAREHOUSE SYSTEM" data-de="LAGERSYSTEM">LAGERSYSTEM</div>
        <div class="r-row"><span class="r-lbl">Lager</span><span class="r-val" id="r-lager">TKL Flex</span></div>
        <div class="r-row"><span class="r-lbl" data-en="Type" data-de="Typ">Type</span><span class="r-val" id="r-type">GF</span></div>
        <div class="r-row"><span class="r-lbl">Variante</span><span class="r-val" id="r-var">LMS</span></div>

        <div class="r-section" data-en="COLUMN SPECIFICATION" data-de="ST√úTZENSPEZIFIKATION">COLUMN SPECIFICATION</div>
        <div class="r-row"><span class="r-lbl" data-en="Column Section" data-de="St√ºtze">St√ºtze</span><span class="r-val big" id="r-stutze">HEB 180</span></div>
        <div class="r-row"><span class="r-lbl">Material</span><span class="r-val" id="r-mat">S355</span></div>
        <div class="r-row"><span class="r-lbl">Palettenplatz</span><span class="r-val" id="r-palet">‚Äì</span></div>

        <div class="r-section" data-en="IN DEVELOPMENT" data-de="IN ENTWICKLUNG">IN DEVELOPMENT</div>
        <div class="r-row"><span class="r-lbl">Schubdorn</span>    <span class="r-val dim" data-en="in development" data-de="in Entwicklung">in development</span></div>
        <div class="r-row"><span class="r-lbl">Ankerbolzen</span>  <span class="r-val dim" data-en="in development" data-de="in Entwicklung">in development</span></div>
        <div class="r-row"><span class="r-lbl">Gewicht</span>      <span class="r-val dim" data-en="in development" data-de="in Entwicklung">in development</span></div>
      </div>

      <!-- Action buttons -->
      <div class="action-btns">
        <button class="abtn btn-reset" onclick="resetAll()">üîÑ <span data-en="Reset" data-de="Zur√ºcksetzen">Reset</span></button>
        <button class="abtn btn-pdf"   onclick="exportPDF()">üìÑ <span data-en="Export PDF" data-de="PDF exportieren">Export PDF</span></button>
        <button class="abtn btn-tbl"   onclick="openModal()">üìã <span data-en="Full Data Table" data-de="Vollst√§ndige Datentabelle">Full Data Table</span></button>
      </div>

      <!-- Info box -->
      <div class="info-box">
        <strong data-en="How it works:" data-de="Funktionsweise:">How it works:</strong>
        <ul>
          <li><strong>Lager / Lager Type:</strong> <span data-en="Only TKL Flex ¬∑ GF is fully implemented. Other configurations are under development." data-de="Nur TKL Flex ¬∑ GF ist vollst√§ndig implementiert. Weitere Konfigurationen befinden sich in Entwicklung.">Only TKL Flex ¬∑ GF fully implemented. Others under development.</span></li>
          <li><strong>Variante:</strong> <span data-en="Structural rack system (single-depth, mobile, or double)." data-de="Regalsystem-Variante (einfachtief, fahrbar oder doppelt).">Structural rack system (single-depth, mobile, or double).</span></li>
          <li><strong data-en="Seismic Zone:" data-de="Erdbebenzone:">Seismic Zone:</strong> <span data-en="Higher acceleration ‚Üí heavier column required." data-de="H√∂here Bodenbeschleunigung ‚Üí schwerere St√ºtze erforderlich.">Higher acceleration ‚Üí heavier column required.</span></li>
          <li><strong data-en="Height:" data-de="H√∂he:">Height:</strong> <span data-en="Larger effective length increases buckling risk ‚Üí larger section." data-de="Gr√∂√üere Knickl√§nge erh√∂ht Knickgefahr ‚Üí gr√∂√üeres Profil erforderlich.">Larger effective length ‚Üí larger section.</span></li>
        </ul>
      </div>

    </div><!-- /right -->
  </div><!-- /layout -->

  <div style="text-align:center;margin-top:14px;padding-top:10px;border-top:1px solid var(--step);font-size:11px;color:var(--muted);letter-spacing:.5px;">
    Developed by <strong>Amin Khodarahmi</strong>
  </div>

</div><!-- /wrap -->

<!-- FULL DATA MODAL -->
<div class="modal-bg" id="modal">
  <div class="modal">
    <button class="modal-close" onclick="closeModal()">‚úï</button>
    <h2 data-en="Full Selection Data ‚Äî All Configurations" data-de="Vollst√§ndige Auswahldaten ‚Äì Alle Konfigurationen">Full Selection Data ‚Äî All Configurations</h2>
    <div class="modal-actions">
      <button class="modal-pdf-btn" onclick="exportTablePDF()">üìÑ <span data-en="Export Table PDF" data-de="Tabelle als PDF">Export Table PDF</span></button>
    </div>
    <div style="overflow-y:auto;max-height:60vh;">
    <table class="tbl" id="data-table">
      <thead>
        <tr>
          <th>Lager</th><th data-en="Type" data-de="Typ">Type</th><th>Variante</th>
          <th data-en="Seismic Zone" data-de="Erdbebenzone">Seismic Zone</th>
          <th data-en="Height (mm)" data-de="H√∂he (mm)">Height (mm)</th>
          <th>St√ºtze</th><th>Material</th><th>PP</th>
        </tr>
      </thead>
      <tbody id="tbl-body"></tbody>
    </table>
    </div>
  </div>
</div>

<script>
/* ‚îÄ‚îÄ i18n ‚îÄ‚îÄ */
let LANG = 'de';
function setLang(l){
  LANG = l;
  document.querySelectorAll('[data-en]').forEach(el=>{
    const t = el.getAttribute('data-'+l);
    if(t) el.textContent = t;
  });
  const mo = document.getElementById('manual-opt');
  if(mo) mo.textContent = l==='en' ? 'Manual input ‚Ä¶' : 'Manuelle Eingabe ‚Ä¶';
}

/* ‚îÄ‚îÄ STATE ‚îÄ‚îÄ */
const S = { lager:'TKL Flex', lagerType:'GF', variante:'LMS', seismic:0.25, height:24 };

function isDev(){ return S.lager !== 'TKL Flex' || S.lagerType !== 'GF'; }

function lockSteps(locked){
  ['s2','s3','s4','s5'].forEach(id=>{
    document.getElementById(id).classList.toggle('off', locked && id !== 's2');
  });
  // s2 disabled only when lager is not TKL Flex
  document.getElementById('s2').classList.toggle('off', S.lager !== 'TKL Flex');
}

function onLager(){
  S.lager = document.getElementById('lager').value;
  const notTKL = S.lager !== 'TKL Flex';
  // Lock ALL subsequent steps if not TKL Flex
  ['s2','s3','s4','s5'].forEach(id => document.getElementById(id).classList.toggle('off', notTKL));
  document.getElementById('dev-note').style.display = notTKL ? 'block' : (isDev() ? 'block' : 'none');
  calc();
}

function onLagerType(){
  S.lagerType = document.getElementById('lagertype').value;
  const notGF = S.lagerType !== 'GF';
  ['s3','s4','s5'].forEach(id => document.getElementById(id).classList.toggle('off', notGF));
  document.getElementById('dev-note').style.display = isDev() ? 'block' : 'none';
  calc();
}

function onHoehe(){
  const v = document.getElementById('hoehe').value;
  document.getElementById('manual-row').style.display = v === 'manual' ? 'flex' : 'none';
  if(v !== 'manual'){ S.height = parseFloat(v); calc(); }
}function onManual(){
  const v = parseFloat(document.getElementById('hoehe-manual').value);
  if(v > 0){ S.height = v; calc(); }
}

/* ‚îÄ‚îÄ DOPPEL LOOKUP TABLE ‚îÄ‚îÄ */
const DOPPEL_TABLE = {
  '0.25': [ {h:6175, pp:24, p:'HEB 180'}, {h:6915, pp:28, p:'HEB 200'}, {h:7900, pp:33, p:'HEB 220'} ]
};

/* ‚îÄ‚îÄ LMS LOOKUP TABLE ‚îÄ‚îÄ */
const LMS_TABLE = {
  '0.25':  [ {h:7085, pp:23, p:'HEB 180'}, {h:8010, pp:28, p:'HEB 200'} ],
  '0.5':   [ {h:6345, pp:19, p:'HEB 180'}, {h:7270, pp:24, p:'HEB 200'}, {h:8010, pp:28, p:'HEB 220'} ],
  '0.75':  [ {h:5420, pp:14, p:'HEB 180'}, {h:6160, pp:18, p:'HEB 200'}, {h:7085, pp:23, p:'HEB 220'}, {h:7625, pp:27, p:'HEB 240'}, {h:8010, pp:28, p:'HEB 260'} ],
  '1':    [ {h:5050, pp:12, p:'HEB 180'}, {h:5420, pp:14, p:'HEB 200'}, {h:5975, pp:17, p:'HEB 220'} ]
};

/* ‚îÄ‚îÄ LMC LOOKUP TABLE ‚îÄ‚îÄ */
const LMC_TABLE = {
  '0.25':  [ {h:6855, pp:25, p:'HEB 180'}, {h:7780, pp:30, p:'HEB 200'}, {h:7975, pp:31, p:'HEB 220'} ],
  '0.5':   [ {h:6670, pp:24, p:'HEB 180'}, {h:7595, pp:27, p:'HEB 200'}, {h:7975, pp:31, p:'HEB 220'} ],
  '0.75':  [ {h:6300, pp:22, p:'HEB 180'}, {h:7225, pp:27, p:'HEB 200'}, {h:7975, pp:31, p:'HEB 220'} ],
  '1':     [ {h:5930, pp:20, p:'HEB 180'}, {h:6855, pp:25, p:'HEB 200'}, {h:7780, pp:30, p:'HEB 220'}, {h:7975, pp:31, p:'HEB 240'} ],
  '1.25':  [ {h:5375, pp:17, p:'HEB 180'}, {h:6300, pp:22, p:'HEB 200'}, {h:7225, pp:27, p:'HEB 220'}, {h:7965, pp:31, p:'HEB 240'} ],
  '1.5':   [ {h:5005, pp:15, p:'HEB 180'}, {h:5745, pp:19, p:'HEB 200'}, {h:6485, pp:23, p:'HEB 220'}, {h:7410, pp:28, p:'HEB 240'}, {h:7965, pp:31, p:'HEB 260'} ]
};

/* ‚îÄ‚îÄ CALC ‚îÄ‚îÄ */
function getHEB(){
  if(S.variante === 'DOPPEL'){
    const rows = DOPPEL_TABLE['0.25'];
    const match = rows.find(r => S.height <= r.h);
    return match ? match.p : rows[rows.length-1].p;
  }
  if(S.variante === 'LMS'){
    const key = String(S.seismic);
    const rows = LMS_TABLE[key];
    if(!rows) return 'N/A';
    const match = rows.find(r => S.height <= r.h);
    return match ? match.p : rows[rows.length-1].p;
  }
  if(S.variante === 'LMC'){
    const key = String(S.seismic);
    const rows = LMC_TABLE[key];
    if(!rows) return 'N/A';
    const match = rows.find(r => S.height <= r.h);
    return match ? match.p : rows[rows.length-1].p;
  }
  return 'N/A';
}

const PALET = { LMS:'2.70 √ó 1.10 m', LMC:'2.70 √ó 1.10 m', DOPPEL:'2.70 √ó 2.20 m' };

function updateDropdownsForVariante(){
  const seismicSel = document.getElementById('seismic');
  const hoeheSel   = document.getElementById('hoehe');

  if(S.variante === 'DOPPEL'){
    seismicSel.innerHTML = '<option value="0.25">0.00 ‚Äì 0.25</option>';
    S.seismic = 0.25;
    hoeheSel.innerHTML = `
      <option value="6175">6175 mm</option>
      <option value="6915">6915 mm</option>
      <option value="7900">7900 mm</option>`;
    S.height = 6175;
  } else if(S.variante === 'LMS'){
    seismicSel.innerHTML = `
      <option value="0.25">0.00 ‚Äì 0.25</option>
      <option value="0.5">0.25 ‚Äì 0.50</option>
      <option value="0.75">0.50 ‚Äì 0.75</option>
      <option value="1">0.75 ‚Äì 1.00</option>`;
    S.seismic = 0.25;
    _updateLMSHoehe('0.25');
  } else if(S.variante === 'LMC'){
    seismicSel.innerHTML = `
      <option value="0.25">0.00 ‚Äì 0.25</option>
      <option value="0.5">0.25 ‚Äì 0.50</option>
      <option value="0.75">0.50 ‚Äì 0.75</option>
      <option value="1">0.75 ‚Äì 1.00</option>
      <option value="1.25">1.00 ‚Äì 1.25</option>
      <option value="1.5">1.25 ‚Äì 1.50</option>`;
    S.seismic = 0.25;
    _updateLMCHoehe('0.25');
  } else {
    // Restore full options for other variantes
    seismicSel.innerHTML = `
      <option value="0.25">0.00 ‚Äì 0.25</option>
      <option value="0.5">0.25 ‚Äì 0.50</option>
      <option value="0.75">0.50 ‚Äì 0.75</option>
      <option value="1.00">0.75 ‚Äì 1.00</option>
      <option value="1.25">1.00 ‚Äì 1.25</option>
      <option value="1.50">1.25 ‚Äì 1.50</option>`;
    seismicSel.value = '0.25';
    S.seismic = 0.25;
    hoeheSel.innerHTML = `
      <option value="21">21</option>
      <option value="22">22</option>
      <option value="23">23</option>
      <option value="24" selected>24</option>
      <option value="25">25</option>
      <option value="26">26</option>
      <option value="27">27</option>
      <option value="31">31</option>
      <option value="manual" id="manual-opt">Manual input ‚Ä¶</option>`;
    S.height = 24;
  }
}

function _updateLMSHoehe(seismicKey){
  const hoeheSel = document.getElementById('hoehe');
  const rows = LMS_TABLE[seismicKey] || [];
  hoeheSel.innerHTML = rows.map(r => `<option value="${r.h}">${r.h} mm</option>`).join('');
  if(rows.length) S.height = rows[0].h;
}

function _updateLMCHoehe(seismicKey){
  const hoeheSel = document.getElementById('hoehe');
  const rows = LMC_TABLE[seismicKey] || [];
  hoeheSel.innerHTML = rows.map(r => `<option value="${r.h}">${r.h} mm</option>`).join('');
  if(rows.length) S.height = rows[0].h;
}

let lastVariante = 'LMS';

function calc(){
  const newVariante = document.getElementById('variante').value;
  if(newVariante !== lastVariante){
    lastVariante = newVariante;
    S.variante = newVariante;
    updateDropdownsForVariante();
  } else {
    S.variante = newVariante;
  }
  S.seismic = parseFloat(document.getElementById('seismic').value);

  // For LMS/LMC: when seismic changes, rebuild hoehe options
  if(S.variante === 'LMS' || S.variante === 'LMC'){
    const currentHoehe = document.getElementById('hoehe').value;
    if(S.variante === 'LMS') _updateLMSHoehe(String(S.seismic));
    else _updateLMCHoehe(String(S.seismic));
    // Try to keep same value if still available
    const hoeheSel = document.getElementById('hoehe');
    const exists = Array.from(hoeheSel.options).some(o => o.value === currentHoehe);
    if(exists) { hoeheSel.value = currentHoehe; S.height = parseFloat(currentHoehe); }
  }

  const hv = document.getElementById('hoehe').value;
  if(hv !== 'manual') S.height = parseFloat(hv);

  document.getElementById('r-lager').textContent = S.lager;
  document.getElementById('r-type').textContent  = S.lagerType;
  document.getElementById('r-var').textContent   = S.variante;
  document.getElementById('r-mat').textContent   = 'S355';
  const pn = document.getElementById('proj-name').value.trim();
  document.getElementById('r-projname').textContent = pn || '‚Äì';

  const dev = isDev();
  document.getElementById('dev-note').style.display = dev ? 'block' : 'none';
  const pdfBtn = document.querySelector('.btn-pdf');
  pdfBtn.disabled = dev;
  pdfBtn.style.opacity = dev ? '0.4' : '1';
  pdfBtn.style.cursor = dev ? 'not-allowed' : 'pointer';

  if(dev){
    document.getElementById('r-stutze').textContent = '‚Äì';
    document.getElementById('r-palet').textContent  = '‚Äì';
  } else {
    const heb = getHEB();
    document.getElementById('r-stutze').textContent = heb;
    // PP from lookup tables
    if(S.variante === 'DOPPEL'){
      const rows = DOPPEL_TABLE['0.25'];
      const match = rows.find(r => S.height <= r.h);
      document.getElementById('r-palet').textContent = match ? match.pp : rows[rows.length-1].pp;
    } else if(S.variante === 'LMS'){
      const rows = LMS_TABLE[String(S.seismic)] || [];
      const match = rows.find(r => S.height <= r.h);
      document.getElementById('r-palet').textContent = match ? match.pp : (rows.length ? rows[rows.length-1].pp : '‚Äì');
    } else if(S.variante === 'LMC'){
      const rows = LMC_TABLE[String(S.seismic)] || [];
      const match = rows.find(r => S.height <= r.h);
      document.getElementById('r-palet').textContent = match ? match.pp : (rows.length ? rows[rows.length-1].pp : '‚Äì');
    } else {
      document.getElementById('r-palet').textContent = PALET[S.variante] || '‚Äì';
    }
  }
}

/* ‚îÄ‚îÄ RESET ‚îÄ‚îÄ */
function resetAll(){
  S.lager='TKL Flex'; S.lagerType='GF'; S.variante='LMS'; S.seismic=0.25; S.height=24;
  lastVariante = 'LMS';
  document.getElementById('lager').value    = 'TKL Flex';
  document.getElementById('lagertype').value= 'GF';
  document.getElementById('variante').value = 'LMS';
  // Restore full seismic + hoehe dropdowns in case DOPPEL was selected
  updateDropdownsForVariante();
  document.getElementById('seismic').value  = '0.25';
  document.getElementById('hoehe').value    = '24';
  document.getElementById('hoehe-manual').value = 24;
  document.getElementById('manual-row').style.display = 'none';
  ['s2','s3','s4','s5'].forEach(id => document.getElementById(id).classList.remove('off'));
  document.getElementById('dev-note').style.display = 'none';
  calc();
}

/* ‚îÄ‚îÄ PDF EXPORT ‚îÄ‚îÄ */
function exportPDF(){
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF({ unit:'mm', format:'a4' });
  const lbl = LANG==='en';

  doc.setFillColor(30,60,114);
  doc.rect(0,0,210,28,'F');
  doc.setTextColor(255,255,255);
  doc.setFontSize(18); doc.setFont('helvetica','bold');
  doc.text('STOPA', 14, 12);
  doc.setFontSize(11); doc.setFont('helvetica','normal');
  doc.text(lbl ? 'Column Selection Tool ‚Äî Result Report' : 'St√ºtzenauswahl-Werkzeug ‚Äî Ergebnisbericht', 14, 21);

  doc.setTextColor(80,80,80);
  doc.setFontSize(9);
  doc.text(new Date().toLocaleDateString('de-DE',{day:'2-digit',month:'2-digit',year:'numeric'}), 196, 21, {align:'right'});

  let y = 38;
  const row = (label, value, big=false)=>{
    doc.setFont('helvetica','normal'); doc.setFontSize(10); doc.setTextColor(100,100,100);
    doc.text(label+':', 14, y);
    doc.setFont('helvetica','bold');
    if(big){ doc.setTextColor(180,120,0); } else { doc.setTextColor(20,20,20); }
    doc.setFontSize(big ? 13 : 10);
    doc.text(String(value), 80, y);
    y += big ? 9 : 7;
  };
  const sect = (t)=>{
    y += 3;
    doc.setFont('helvetica','bold'); doc.setFontSize(8); doc.setTextColor(30,60,114);
    doc.text(t.toUpperCase(), 14, y); y += 5;
    doc.setDrawColor(30,60,114); doc.setLineWidth(.3); doc.line(14, y, 196, y); y += 4;
  };

  sect(lbl ? 'Project' : 'Projekt');
  const projName = document.getElementById('proj-name').value.trim();
  row(lbl?'Project Name':'Projektname', projName || '‚Äì');

  sect(lbl ? 'Warehouse System' : 'Lagersystem');
  row('Lager',     S.lager);
  row(lbl?'Type':'Typ', S.lagerType);
  row('Variante',  S.variante);

  sect(lbl ? 'Column Specification' : 'St√ºtzenspezifikation');
  row(lbl ? 'Column Section' : 'St√ºtze', getHEB(), true);
  row('Material', 'S355');
  // Get PP from lookup tables
  let ppVal = '‚Äì';
  if(S.variante==='DOPPEL'){ const r=DOPPEL_TABLE['0.25'].find(r=>S.height<=r.h); ppVal=r?r.pp:DOPPEL_TABLE['0.25'].slice(-1)[0].pp; }
  else if(S.variante==='LMS'){ const rows=LMS_TABLE[String(S.seismic)]||[]; const r=rows.find(r=>S.height<=r.h); ppVal=r?r.pp:(rows.length?rows.slice(-1)[0].pp:'‚Äì'); }
  else if(S.variante==='LMC'){ const rows=LMC_TABLE[String(S.seismic)]||[]; const r=rows.find(r=>S.height<=r.h); ppVal=r?r.pp:(rows.length?rows.slice(-1)[0].pp:'‚Äì'); }
  row('Palettenplatz', ppVal);
  row(lbl?'Seismic Zone':'Erdbebenzone', document.getElementById('seismic').selectedOptions[0].text);
  row(lbl?'Height (mm)':'H√∂he (mm)', S.height);

  sect(lbl ? 'In Development' : 'In Entwicklung');
  const inDev = lbl ? 'in development' : 'in Entwicklung';
  row('Schubdorn',   inDev);
  row('Ankerbolzen', inDev);
  row('Gewicht',     inDev);

  doc.setFont('helvetica','italic'); doc.setFontSize(8); doc.setTextColor(150,150,150);
  doc.text('www.stopa.com', 14, 285);
  doc.text('Developed by Amin Khodarahmi', 196, 285, {align:'right'});
  doc.save('STOPA_Stuetzenauswahl.pdf');
}

/* ‚îÄ‚îÄ FULL TABLE MODAL ‚îÄ‚îÄ */
const VARIANTEN   = ['LMS','LMC','DOPPEL'];
const LMC_SEISMIC_LABELS = {'0.25':'0.00‚Äì0.25','0.5':'0.25‚Äì0.50','0.75':'0.50‚Äì0.75','1':'0.75‚Äì1.00','1.25':'1.00‚Äì1.25','1.5':'1.25‚Äì1.50'};
const LMS_SEISMIC_LABELS = {'0.25':'0.00‚Äì0.25','0.5':'0.25‚Äì0.50','0.75':'0.50‚Äì0.75','1':'0.75‚Äì1.00'};
const LMC_KEYS_ORDERED = ['0.25','0.5','0.75','1','1.25','1.5'];
const LMS_KEYS_ORDERED = ['0.25','0.5','0.75','1'];

function openModal(){
  const tbody = document.getElementById('tbl-body');
  tbody.innerHTML = '';
  VARIANTEN.forEach(vt => {
    const tr0 = document.createElement('tr');
    tr0.className = 'head-row';
    tr0.innerHTML = `<td colspan="8">Variante: ${vt}</td>`;
    tbody.appendChild(tr0);

    if(vt === 'DOPPEL'){
      DOPPEL_TABLE['0.25'].forEach(row => {
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>TKL Flex</td><td>GF</td><td>DOPPEL-WAGEN</td><td>0.00‚Äì0.25</td><td>${row.h}</td><td><strong>${row.p}</strong></td><td>S355</td><td>${row.pp}</td>`;
        tbody.appendChild(tr);
      });
    } else if(vt === 'LMS'){
      LMS_KEYS_ORDERED.forEach(key => {
        (LMS_TABLE[key]||[]).forEach(row => {
          const tr = document.createElement('tr');
          tr.innerHTML = `<td>TKL Flex</td><td>GF</td><td>LMS</td><td>${LMS_SEISMIC_LABELS[key]}</td><td>${row.h}</td><td><strong>${row.p}</strong></td><td>S355</td><td>${row.pp}</td>`;
          tbody.appendChild(tr);
        });
      });
    } else if(vt === 'LMC'){
      LMC_KEYS_ORDERED.forEach(key => {
        (LMC_TABLE[key]||[]).forEach(row => {
          const tr = document.createElement('tr');
          tr.innerHTML = `<td>TKL Flex</td><td>GF</td><td>LMC</td><td>${LMC_SEISMIC_LABELS[key]}</td><td>${row.h}</td><td><strong>${row.p}</strong></td><td>S355</td><td>${row.pp}</td>`;
          tbody.appendChild(tr);
        });
      });
    }
  });
  document.getElementById('modal').classList.add('open');
}

function exportTablePDF(){
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF({ unit:'mm', format:'a4', orientation:'landscape' });
  doc.setFillColor(30,60,114);
  doc.rect(0,0,297,20,'F');
  doc.setTextColor(255,255,255);
  doc.setFontSize(14); doc.setFont('helvetica','bold');
  doc.text('STOPA ‚Äì Full Column Selection Data', 14, 13);
  doc.setFontSize(8); doc.setFont('helvetica','normal');
  doc.text(new Date().toLocaleDateString('de-DE',{day:'2-digit',month:'2-digit',year:'numeric'}), 283, 13, {align:'right'});

  const headers = ['Lager','Type','Variante','Seismic Zone','Height (mm)','St√ºtze','Material','PP'];
  const rows = [];
  VARIANTEN.forEach(vt => {
    if(vt==='DOPPEL'){
      DOPPEL_TABLE['0.25'].forEach(r => rows.push(['TKL Flex','GF','DOPPEL-WAGEN','0.00‚Äì0.25',r.h,r.p,'S355',r.pp]));
    } else if(vt==='LMS'){
      LMS_KEYS_ORDERED.forEach(k => (LMS_TABLE[k]||[]).forEach(r => rows.push(['TKL Flex','GF','LMS',LMS_SEISMIC_LABELS[k],r.h,r.p,'S355',r.pp])));
    } else if(vt==='LMC'){
      LMC_KEYS_ORDERED.forEach(k => (LMC_TABLE[k]||[]).forEach(r => rows.push(['TKL Flex','GF','LMC',LMC_SEISMIC_LABELS[k],r.h,r.p,'S355',r.pp])));
    }
  });

  let y = 28;
  // Landscape A4 = 297mm wide, usable 269mm (14 margin each side)
  const colW = [30,18,36,36,34,28,24,18]; // total = 224mm, padded evenly
  const x0 = 14;
  let cx;
  // Header row
  doc.setFillColor(30,60,114);
  cx = x0;
  colW.forEach(w => { doc.rect(cx,y,w,8,'F'); cx+=w; });
  doc.setTextColor(255,255,255); doc.setFontSize(8); doc.setFont('helvetica','bold');
  cx = x0;
  colW.forEach((w,i) => { doc.text(headers[i], cx+2, y+5.5); cx+=w; });
  y+=8;
  doc.setFont('helvetica','normal'); doc.setTextColor(30,30,30);
  rows.forEach((row,ri) => {
    if(y > 190){ doc.addPage(); y=14; }
    doc.setFillColor(ri%2===0?244:255,ri%2===0?247:255,ri%2===0?251:255);
    cx = x0; colW.forEach(w => { doc.rect(cx,y,w,7,'F'); cx+=w; });
    cx = x0;
    row.forEach((cell,i) => { doc.text(String(cell), cx+2, y+4.8); cx+=colW[i]; });
    y+=7;
  });
  doc.setFont('helvetica','italic'); doc.setFontSize(7); doc.setTextColor(150,150,150);
  doc.text('www.stopa.com | Developed by Amin Khodarahmi', 14, 205);
  doc.save('STOPA_Vollstaendige_Tabelle.pdf');
}
function closeModal(){ document.getElementById('modal').classList.remove('open'); }
document.getElementById('modal').addEventListener('click', e=>{ if(e.target===e.currentTarget) closeModal(); });

/* ‚îÄ‚îÄ INIT ‚îÄ‚îÄ */
window.addEventListener('DOMContentLoaded', () => { setLang('de'); updateDropdownsForVariante(); calc(); });
</script>
</body>
</html>
